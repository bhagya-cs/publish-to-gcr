name: Build-Docker-Image

on: [push]

jobs: 
    build_docker_img:
     runs-on: ubuntu-latest
     env:
        TAG: java-api
        PAT: ${{ secrets.GITHUB_TOKEN }}
        USER: bhagya-cs
        REGISTRY: ghcr.io
        VERSION: v1

     steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Build Docker Image
          run: docker build -t $TAG .

        - name: Login to gHCR
          run: |
           docker login ghcr.io -u $USER --password ${{ secrets.GH_PAT }}
           docker tag $TAG ghcr.io/$USER/$TAG:$VERSION
           docker push ghcr.io/$USER/$TAG:$VERSION
